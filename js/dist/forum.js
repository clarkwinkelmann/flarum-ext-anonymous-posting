(()=>{var n={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return n.d(t,{a:t}),t},d:(o,t)=>{for(var r in t)n.o(t,r)&&!n.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:t[r]})},o:(n,o)=>Object.prototype.hasOwnProperty.call(n,o),r:n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}},o={};(()=>{"use strict";function t(){return t=Object.assign?Object.assign.bind():function(n){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},t.apply(this,arguments)}n.r(o);const r=flarum.core.compat["forum/app"];var a=n.n(r);const s=flarum.core.compat["common/extend"],e=flarum.core.compat["common/utils/humanTime"];var i=n.n(e);const c=flarum.core.compat["common/utils/extractText"];var u=n.n(c);const l=flarum.core.compat["common/helpers/icon"];var p=n.n(l);const d=flarum.core.compat["common/components/Button"];var f=n.n(d);const y=flarum.core.compat["common/components/Link"];var v=n.n(y);const h=flarum.core.compat["common/components/Switch"];var b=n.n(h);const g=flarum.core.compat["common/components/Tooltip"];var A=n.n(g);const k=flarum.core.compat["common/Model"];var w=n.n(k);const P=flarum.core.compat["common/models/Post"];var x=n.n(P);const C=flarum.core.compat["forum/utils/DiscussionControls"];var z=n.n(C);const O=flarum.core.compat["forum/utils/PostControls"];var N=n.n(O);const U=flarum.core.compat["forum/components/CommentPost"];var M=n.n(U);const E=flarum.core.compat["forum/components/Composer"];var S=n.n(E);const I=flarum.core.compat["forum/components/DiscussionComposer"];var _=n.n(I);const j=flarum.core.compat["forum/components/ReplyComposer"];var T=n.n(j);const D=flarum.core.compat["forum/components/PostUser"];var B=n.n(D);const L=flarum.core.compat["forum/components/DiscussionListItem"];var H=n.n(L);const V=flarum.core.compat["forum/components/ReplyPlaceholder"];var R=n.n(V);const $=flarum.core.compat["forum/components/TerminalPost"];var q=n.n($);const F=flarum.core.compat["forum/components/PostPreview"];var G=n.n(F);const J=flarum.core.compat["forum/components/PostsUserPage"];var K=n.n(J);function Q(n,o){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(t)return(t=t.call(n)).next.bind(t);if(Array.isArray(n)||(t=function(n,o){if(n){if("string"==typeof n)return W(n,o);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?W(n,o):void 0}}(n))||o&&n&&"number"==typeof n.length){t&&(n=t);var r=0;return function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function W(n,o){(null==o||o>n.length)&&(o=n.length);for(var t=0,r=new Array(o);t<o;t++)r[t]=n[t];return r}function X(){a().composer.fields.isAnonymous=!!a().forum.attribute("defaultAnonymousPost")}function Y(n){if(a().forum.attribute("canAnonymousSwitch")){var o=a().translator.trans("clarkwinkelmann-anonymous-posting.forum.composerControls.anonymizeHelp"),t=a().forum.attribute("anonymousHelpTextPosition");n.add("anonymous-posting",b().component({className:"visible"===t?"AnonymousCheckbox--multiline":"",state:!!a().composer.fields.isAnonymous,onchange:function(n){a().composer.fields.isAnonymous=n}},m("span.AnonymousCheckboxLabel",[a().translator.trans("clarkwinkelmann-anonymous-posting.forum.composerControls.anonymize"),"tooltip"===t?[" ",A().component({text:o},p()("fas fa-info-circle",{className:"AnonymousCheckboxInfo"}))]:null,"visible"===t?m(".helpText",o):null])),-10)}}function Z(n){n.isAnonymous=!!a().composer.fields.isAnonymous}function nn(n){var o=this;a().composer.fields.isAnonymous&&n&&Array.isArray(n.children)&&n.children.forEach((function(n){n&&Array.isArray(n.children)&&n.children.forEach((function(t,r){t&&t.attrs&&t.attrs.className&&-1!==t.attrs.className.indexOf("ComposerBody-avatar")&&("tags"in a().composer.fields?n.children[r]=tn(a().forum,".ComposerBody-avatar","Discussion",a().composer.fields.tags):o instanceof T()&&a().composer.body.attrs.discussion.data.relationships&&"tags"in a().composer.body.attrs.discussion.data.relationships?n.children[r]=tn(a().forum,".ComposerBody-avatar","Post",a().composer.body.attrs.discussion.data.relationships.tags.data):n.children[r]=tn(a().forum,".ComposerBody-avatar"))}))}))}function on(n){return{url:n.user_avatar_url,alt:n.user_username}}function tn(n,o,t,r){void 0===o&&(o="");var s=function(n,o,t,r){var s=null;if(r&&t&&o in t)for(var e,i=t[o],c=Q(r);!(e=c()).done;){var m=e.value,u="tags"==m.type?m.id:"tags"==m.data.type?Number(m.data.id):null;if(u in i){s=on(i[u]);break}}return null==s&&n&&(s={url:n,alt:a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.username")}),s}(n.attribute("anonymousAvatarUrl"),t,n.attribute("anonymousImposters"),r);return s?s.url?m("img.Avatar.Avatar--anonymous"+o,{src:s.url,alt:s.alt}):m("span.Avatar ComposerBody-avatar"+o,{alt:s.alt,style:"--avatar-bg: #a0e5b3;"},s.alt.charAt(0).toUpperCase()):m("span.Avatar.Avatar--anonymous"+o,a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.initials"))}a().initializers.add("anonymous-posting",(function(){(0,s.extend)(M().prototype,"headerItems",(function(n){var o=this,r=this.attrs.post;if(r.attribute("isAnonymous")){if(n.setContent("user",m(".PostUser",m("h3",[tn(r,".PostUser-avatar"),m("span.username",a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.username"))]))),!w().hasOne("anonymousUser").call(r)){if(!r.attribute("isAnonymousMe"))return;var s=".AnonymousPostPrivacyMine",e=a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postPrivacy.mineHelp"),i=a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postPrivacy.mine");return a().current.matches(K())&&(s=".AnonymousPostPrivacyProfile",e=a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postPrivacy.profileHelp"),i=a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postPrivacy.profile")),void n.add("anonymousUserPrivacy",A().component({text:e},m("span.AnonymousPostPrivacy"+s,i)),90)}var c=new(x())(t({},r.data,{relationships:t({},r.data.relationships,{user:r.data.relationships.anonymousUser})}));n.add("anonymousUser",B().component({post:c,cardVisible:this.cardVisible,oncardshow:function(){o.cardVisible=!0,m.redraw()},oncardhide:function(){o.cardVisible=!1,m.redraw()}}),90)}})),(0,s.extend)(R().prototype,"view",(function(n){a().composer.fields.isAnonymous&&n&&Array.isArray(n.children)&&n.children.forEach((function(n){n&&Array.isArray(n.children)&&n.children.forEach((function(n){n&&Array.isArray(n.children)&&n.children.forEach((function(o,t){o&&Array.isArray(o.children)&&(o.children.forEach((function(n,t){n&&n.attrs&&n.attrs.className&&(-1!==n.attrs.className.indexOf("PostUser-avatar")&&(a().composer.body.attrs.discussion.data.relationships&&"tags"in a().composer.body.attrs.discussion.data.relationships?o.children[t]=tn(a().forum,".PostUser-avatar","Post",a().composer.body.attrs.discussion.data.relationships.tags.data):o.children[t]=tn(a().forum,".PostUser-avatar")),"username"===n.attrs.className&&(a().composer.body.attrs.discussion.data.relationships&&"tags"in a().composer.body.attrs.discussion.data.relationships?n.text=function(n,o){var t=n.attribute("anonymousImposters");if(o&&t&&"Post"in t)for(var r,s=t.Post,e=Q(o);!(r=e()).done;){var i=r.value.id;if(i in s)return on(s[i]).alt}return a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.username")}(a().forum,a().composer.body.attrs.discussion.data.relationships.tags.data):n.text=a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.username")))})),o.attrs&&o.attrs.className&&-1!==o.attrs.className.indexOf("PostUser-badges")&&n.children.splice(t,1))}))}))}))})),(0,s.extend)(H().prototype,"view",(function(n){var o=this.attrs.discussion;o.attribute("isAnonymous")&&n.children.forEach((function(n){n&&n.attrs&&n.attrs.className&&-1!==n.attrs.className.indexOf("DiscussionListItem-content")&&n.children.forEach((function(n){n&&n.tag===A()&&(n.attrs.text=a().translator.trans("core.forum.discussion_list.started_text",{username:a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.username"),ago:i()(o.createdAt())}),n.children.forEach((function(n){n&&n.tag===v()&&(n.children=[tn(o)])})))}))}))})),(0,s.extend)(G().prototype,"view",(function(n){var o=this;this.attrs.post.attribute("isAnonymous")&&n.children.forEach((function(n){n&&n.attrs&&n.attrs.className&&-1!==n.attrs.className.indexOf("PostPreview-content")&&n.children.forEach((function(t,r){t&&t.attrs&&t.attrs.className&&0===t.attrs.className.indexOf("Avatar")&&n.children.splice(r,1,tn(o.attrs.post))}))}))})),(0,s.override)(q().prototype,"view",(function(n){for(var o=this.attrs.discussion,t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return this.attrs.lastPost&&o.replyCount()?o.lastPostedUser()?n.apply(void 0,r):m("span",[p()("fas fa-reply")," ",a().translator.trans("clarkwinkelmann-anonymous-posting.forum.discussionList.genericReplyText",{ago:i()(o.lastPostedAt())})]):o.attribute("isAnonymous")?m("span",[""," ",a().translator.trans("core.forum.discussion_list.started_text",{username:m("span.username",a().translator.trans("clarkwinkelmann-anonymous-posting.lib.userMeta.username")),ago:i()(o.createdAt())})]):n.apply(void 0,r)})),(0,s.extend)(M().prototype,"oninit",(function(){var n=this;this.subtree.check((function(){return n.attrs.post.attribute("isAnonymous")}))})),(0,s.extend)(_().prototype,"oninit",X),(0,s.extend)(_().prototype,"headerItems",Y),(0,s.extend)(_().prototype,"data",Z),(0,s.extend)(_().prototype,"view",nn),(0,s.extend)(T().prototype,"oninit",X),(0,s.extend)(T().prototype,"headerItems",Y),(0,s.extend)(T().prototype,"data",Z),(0,s.extend)(T().prototype,"view",nn),(0,s.extend)(z(),"moderationControls",(function(n,o){o.attribute("canDeAnonymize")&&n.add("deanonymize",f().component({icon:"fas fa-user-secret",onclick:function(){confirm(u()(a().translator.trans("clarkwinkelmann-anonymous-posting.forum.discussionControls.deanonymizeConfirmation")))&&o.save({isAnonymous:!1}).then((function(){m.redraw()}))}},a().translator.trans("clarkwinkelmann-anonymous-posting.forum.discussionControls.deanonymize"))),o.attribute("canAnonymize")&&n.add("anonymize",f().component({icon:"fas fa-user-secret",onclick:function(){confirm(u()(a().translator.trans("clarkwinkelmann-anonymous-posting.forum.discussionControls.anonymizeConfirmation")))&&o.save({isAnonymous:!0}).then((function(){m.redraw()}))}},a().translator.trans("clarkwinkelmann-anonymous-posting.forum.discussionControls.anonymize")))})),(0,s.extend)(N(),"moderationControls",(function(n,o){o.attribute("canDeAnonymize")&&n.add("deanonymize",f().component({icon:"fas fa-user-secret",onclick:function(){confirm(u()(a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postControls.deanonymizeConfirmation")))&&o.save({isAnonymous:!1}).then((function(){m.redraw()}))}},a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postControls.deanonymize"))),o.attribute("canAnonymize")&&n.add("anonymize",f().component({icon:"fas fa-user-secret",onclick:function(){(1!==o.number()||confirm(u()(a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postControls.firstPostConfirmation"))))&&o.save({isAnonymous:!0}).then((function(){m.redraw()}))}},a().translator.trans("clarkwinkelmann-anonymous-posting.forum.postControls.anonymize")))})),(0,s.override)(S().prototype,"focus",(function(n){var o=this.$(".item-anonymous-posting input");o.prop("disabled",!0);var t=n();return o.prop("disabled",!1),t}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map